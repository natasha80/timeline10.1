(()=>{"use strict";class t{showModal(){this.createModal(),document.body.appendChild(this.modal),this.buttonOk=this.modal.querySelector(".button-ok"),this.buttonOk.addEventListener("click",this.onSaveCoord),this.buttoncancel=this.modal.querySelector(".button-cancel"),this.buttoncancel.addEventListener("click",this.onCancel)}onCancel(t){t.preventDefault();let{modal:e}=this.modal;document.body.removeChild(e),e=null}onSaveCoord(t){t.preventDefault();let{modal:e}=this.modal;const o=e.querySelector(".form__text");this.coord=o.value;if(!this.modal.checkFormat(this.coord)){const t=e.querySelector(".warning");return t.textContent=this.warning,o.style.background="#dba1a1",void setTimeout((()=>{t.textContent=""}),2e3)}this.createTextPost(),document.body.removeChild(e),e=null}createModal(){this.modal=document.createElement("div"),this.modal.classList.add("modal"),this.modal.innerHTML='\n      <div class="modal__wrapper">\n        <div class="modal__content">\n          <h3 class="modal__title">–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫</h3>\n          <p class="modal__text">–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–∞–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏, –ª–∏–±–æ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Ä—É—á–Ω—É—é.</p>\n          <p class="modal__text">–®–∏—Ä–æ—Ç–∞ –∏ –¥–æ–ª–≥–æ—Ç–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</p>\n          <textarea type="text" class="form__text" required></textarea>\n          <button class="form__button button button-cancel">–û—Ç–º–µ–Ω–∞</button>\n          <button class="form__button button button-ok">ok</button>\n          <div class=\'warning\'></div>\n        </div>\n      </div>\n      '}checkFormat(t){const e=t.split(",").map((t=>t.match(/[+|‚àí|-|‚Äî|-]?\d{1,3}\.\d+/)));return e[0]&&e[1]?(this.latitude=e[0][0],this.longitude=e[1][0],!0):(this.warning="–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ 00.00000, 00.00000",!1)}}const e=new class{constructor(e){"string"==typeof e&&(e=document.querySelector(e)),this.element=e,this.modal=new t,this.createTextPost=this.createTextPost.bind(this),this.onCreatePost=this.onCreatePost.bind(this),this.feed=this.element.querySelector(".timeline__feed"),this.audioBtn=this.element.querySelector(".timeline__create-post-audio"),this.videoBtn=this.element.querySelector(".timeline__create-post-video"),this.textArea=this.element.querySelector(".timeline__create-post-text"),this.modal.showModal=this.modal.showModal.bind(this.modal),this.modal.createModal=this.modal.createModal.bind(this.modal),this.modal.onSaveCoord=this.modal.onSaveCoord.bind(this),this.modal.onCancel=this.modal.onCancel.bind(this),this.modal.checkFormat=this.modal.checkFormat.bind(this)}init(){this.textArea.addEventListener("keydown",(t=>this.onCreatePost(t)))}onCreatePost(t){this.text=this.textArea.value.trim(),"Enter"===t.key&&this.text&&(t.preventDefault(),""===t.currentTarget.value?this.showMistake(t.currentTarget,"–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ"):new Promise(((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){const{latitude:o,longitude:i}=e.coords;t({latitude:+o.toFixed(5),longitude:+i.toFixed(5)})}),(function(t){e(t)})):e(new Error("close"))})).then((t=>{const{latitude:e,longitude:o}=t;this.latitude=e,this.longitude=o;const i=this.markup–ûfThePost(this.text);this.feed.insertBefore(i,this.feed.firstElementChild)})).catch((()=>{this.modal.showModal()})))}createTextPost(){const t=this.markup–ûfThePost(this.text);this.feed.insertBefore(t,this.feed.firstElementChild)}markup–ûfThePost(t){const e=function(){let t=new Date;return t=t.toLocaleString("ru"),t}(),o=document.createElement("div");return o.classList.add("timeline__feed-post"),o.innerHTML=`\n    <div class="post-date">${e}</div>\n    <div class="post-text">${t}</div>\n    <div class="post-geolacation">[${this.latitude}, ${this.longitude}] üåç</div>\n  `,o}}(".timeline");e.init(),e.latitude="51.24",e.longitude="86.00",e.text="Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolor commodi doloribus vero eligendi sequi voluptas odio? Iste, porro!",e.createTextPost(),e.latitude=void 0,e.latitude=void 0})();